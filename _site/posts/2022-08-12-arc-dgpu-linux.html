<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="unrahul">
<meta name="dcterms.date" content="2022-10-12">

<title>Technical ramblings - Configure Intel Arc A370M Xe-HPG discrete GPU on Linux</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Technical ramblings</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rahulunair"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/unrahu1"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Configure Intel Arc A370M Xe-HPG discrete GPU on Linux</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">intel</div>
                <div class="quarto-category">dgpu</div>
                <div class="quarto-category">graphics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>unrahul </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 12, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#configure-linux-kernel" id="toc-configure-linux-kernel" class="nav-link active" data-scroll-target="#configure-linux-kernel">Configure Linux kernel</a></li>
  <li><a href="#setup-open-source-mesa-3d-graphics-libraries-for-opengl-and-vulkan" id="toc-setup-open-source-mesa-3d-graphics-libraries-for-opengl-and-vulkan" class="nav-link" data-scroll-target="#setup-open-source-mesa-3d-graphics-libraries-for-opengl-and-vulkan">Setup Open source Mesa 3d Graphics libraries for OpenGL and Vulkan</a></li>
  <li><a href="#install-oneapi-basekit-and-device-discovery-using-sycl" id="toc-install-oneapi-basekit-and-device-discovery-using-sycl" class="nav-link" data-scroll-target="#install-oneapi-basekit-and-device-discovery-using-sycl">Install oneAPI basekit and device discovery using sycl</a></li>
  <li><a href="#intels-system-monitoring-utility-to-monitor-the-dgpu" id="toc-intels-system-monitoring-utility-to-monitor-the-dgpu" class="nav-link" data-scroll-target="#intels-system-monitoring-utility-to-monitor-the-dgpu">Intel’s System Monitoring Utility to monitor the dgpu</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#something-not-working" id="toc-something-not-working" class="nav-link" data-scroll-target="#something-not-working">Something not working?</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>These instructions are for Ubuntu 22.04 LTS-based Oses. I am using Pop!_OS 22.04 LTS derivative of Ubuntu 22.04.</p>
<section id="configure-linux-kernel" class="level2">
<h2 class="anchored" data-anchor-id="configure-linux-kernel">Configure Linux kernel</h2>
<ol type="1">
<li>Install the latest available Linux kernel. For example, I have installed <strong>kernel 6.0</strong></li>
</ol>
<p>Install a recent version of the kernel. The easiest way to install a different kernel is by using <a href="https://github.com/bkw777/mainline">Mainline</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → add-apt-repository ppa:cappelikan/ppa</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → apt update</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → apt install mainline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As seen in the screenshot below, I am using Kernel 6.0.0:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/45503355/195398959-c28fe9f3-47c9-46cd-b1a0-5e26d8e6228a.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Mainline kernel installer</figcaption><p></p>
</figure>
</div>
<p>After installing the kernel, please restart the machine.</p>
<ol start="2" type="1">
<li>As Arc dGPUs support are still <code>experimental</code> in the kernel, you will have to force the dGPU to be detected. This can be done using the kernel force_probe parameter <code>i915.force_probe=&lt;device_id&gt;</code> for the Intel i915 HD graphics driver. This will force probe the driver for new Intel graphics devices that are recognized by the kernel but not adequately supported. Hopefully, you wouldn’t have to do that with a newer version of the kernel. I am using a <a href="https://www.lenovo.com/us/en/p/laptops/yoga/yoga-2-in-1-series/yoga-7i-gen-7-(16-inch-intel)">Yoga 7i (16” Intel) with Intel Arc Graphics</a> which has the Intel® Arc™ A370M discrete Graphics card (dgpu) along with an integrated Intel® UHD Graphics. The device id for this dgpu is <code>5693</code>, and you can find the device id of the card either by looking at i915 logs using <code>sudo dmesg | grep -i i915</code> or from Intel’s gpu <a href="https://dgpu-docs.intel.com/devices/hardware-table.html">hardware table</a>.</li>
</ol>
<p>Pop!_OS 22.04 LTS uses systemd to manage kernel boot params, to force i915 driver to enable the dgpu use <code>kernelstub</code> tool:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → kernelstub <span class="at">-a</span> <span class="st">"i915.force_probe=5693"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After this restart the machine and check i915 logs using <code>dmesg</code> to see if the graphics card has been detected:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → dmesg <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> i915</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You should see an output like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> →  dmesg <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> i915</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    0.000000] Command line: <span class="er">initrd=\EFI\Pop_OS-97fe6a26-7d8a-4120-89db-8f2130b644b7\initrd.img</span> <span class="va">root</span><span class="op">=</span>UUID=97fe6a26-7d8a-4120-89db-8f2130b644b7 <span class="ex">ro</span> quiet loglevel=0 systemd.show_status=false splash i915.force_probe=5693</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    0.047217] Kernel command <span class="er">line:</span> <span class="va">initrd</span><span class="op">=</span><span class="dt">\E</span>FI<span class="dt">\P</span>op_OS-97fe6a26-7d8a-4120-89db-8f2130b644b7<span class="dt">\i</span>nitrd.img <span class="va">root</span><span class="op">=</span>UUID=97fe6a26-7d8a-4120-89db-8f2130b644b7 <span class="ex">ro</span> quiet loglevel=0 systemd.show_status=false splash i915.force_probe=5693</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.775328] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> VT-d active for gfx access</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.775383] i915 0000:00:02.0: <span class="er">vgaarb:</span> <span class="ex">deactivate</span> vga console</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.775416] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> Using Transparent Hugepages</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.775979] i915 0000:00:02.0: <span class="er">vgaarb:</span> <span class="ex">changed</span> VGA decodes: olddecodes=io+mem,decodes=none:owns=io+mem</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.777234] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> Finished loading DMC firmware i915/adlp_dmc_ver2_16.bin <span class="er">(</span><span class="ex">v2.16</span><span class="kw">)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.912397] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> GuC firmware i915/adlp_guc_70.1.1.bin version 70.1</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.912399] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> HuC firmware i915/tgl_huc_7.9.3.bin version 7.9</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.926153] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> HuC authenticated</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.926448] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> GuC submission enabled</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.926449] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> GuC SLPC enabled</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.927353] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> GuC RC: enabled</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    1.930736] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> Protected Xe Path <span class="er">(</span><span class="ex">PXP</span><span class="kw">)</span> <span class="ex">protected</span> content support initialized</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.769893] [drm] Initialized <span class="er">i915</span> <span class="ex">1.6.0</span> 20201103 for 0000:00:02.0 on minor 0</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.775461] i915 0000:03:00.0: <span class="er">enabling</span> <span class="ex">device</span> <span class="er">(</span><span class="ex">0000</span> <span class="at">-</span><span class="op">&gt;</span> 0002<span class="kw">)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.775491] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> Incompatible option enable_guc=3 <span class="at">-</span> HuC is not supported!</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.776346] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> VT-d active for gfx access</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.776472] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> Local memory IO size: 0x00000003fa000000</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.776476] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> Local memory available: 0x00000003fa000000</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.787361] fbcon: i915drmfb <span class="er">(fb0)</span> <span class="ex">is</span> primary device</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.787366] i915 0000:00:02.0: <span class="er">[drm</span><span class="ex">]</span> fb0: i915drmfb frame buffer device</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    3.796583] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> Finished loading DMC firmware i915/dg2_dmc_ver2_06.bin <span class="er">(</span><span class="ex">v2.6</span><span class="kw">)</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    5.326692] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> failed to retrieve link info, disabling eDP</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    5.428126] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> GuC firmware i915/dg2_guc_70.1.2.bin version 70.1</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    5.442889] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> GuC submission enabled</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    5.442892] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> GuC SLPC enabled</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>    5.443378] i915 0000:03:00.0: <span class="er">[drm</span><span class="ex">]</span> GuC RC: enabled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The dg2_guc is loaded as seen in the above line: <strong>[ 5.428126] i915 0000:03:00.0: [drm] GuC firmware i915/dg2_guc_70.1.2.bin version 70.1</strong>. Both the igpu and dgpu is detected and also the firmware is loaded. If drm verification fails and <a href="https://01.org/linuxgraphics/downloads/firmware">GuC</a> is not loaded, install the latest linux firmware from this <a href="https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/">link</a>:</p>
<p>You can install the latest firmware files by cloning the repo and moving it to <code>/lib/firmware</code> (<strong>warning</strong>: this is a brute-force approach):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> →  git clone https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> →  cd linux-firmware <span class="kw">&amp;&amp;</span> <span class="fu">yes</span> <span class="kw">|</span> <span class="fu">cp</span> <span class="at">-r</span> <span class="pp">*</span> /lib/firmware</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For me, the firmware that came with Pop!_OS 22.04 LTS worked, i didn’t have to install the latest ones.</p>
</section>
<section id="setup-open-source-mesa-3d-graphics-libraries-for-opengl-and-vulkan" class="level2">
<h2 class="anchored" data-anchor-id="setup-open-source-mesa-3d-graphics-libraries-for-opengl-and-vulkan">Setup Open source Mesa 3d Graphics libraries for OpenGL and Vulkan</h2>
<ol type="1">
<li>Install drivers</li>
</ol>
<p>Now, if you want media and graphics support beyond compute, install bleeding edge Mesa libraries from <a href="https://launchpad.net/~oibaf/+archive/ubuntu/graphics-drivers">oiabf ppa</a> that provides open graphics drivers; you can do it by:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → add-apt-repository ppa:oibaf/graphics-drivers</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → apt-update</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → apt-upgrade</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → dpkg <span class="at">-l</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> mesa</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  libegl-mesa0:amd64                                                      22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        free implementation of the EGL API <span class="at">--</span> Mesa vendor library</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  libgl1-mesa-dri:amd64                                                   22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        free implementation of the OpenGL API <span class="at">--</span> DRI modules</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  libglapi-mesa:amd64                                                     22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        free implementation of the GL API <span class="at">--</span> shared library</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  libglu1-mesa:amd64                                                      9.0.2-1                                                           amd64        Mesa OpenGL utility library <span class="er">(</span><span class="ex">GLU</span><span class="kw">)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  lib</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="ex">-mesa0:amd64</span>                                                      22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        free implementation of the OpenGL API <span class="at">--</span> GLX vendor library</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  mesa-utils                                                              8.4.0-1ubuntu1                                                    amd64        Miscellaneous Mesa utilities <span class="at">--</span> symlinks</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  mesa-utils-bin:amd64                                                    8.4.0-1ubuntu1                                                    amd64        Miscellaneous Mesa utilities <span class="at">--</span> native applications</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  mesa-va-drivers:amd64                                                   22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        Mesa VA-API video acceleration drivers</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  mesa-vdpau-drivers:amd64                                                22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        Mesa VDPAU video acceleration drivers</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="ex">ii</span>  mesa-vulkan-drivers:amd64                                               22.3~git2210120600.ddc5c3~oibaf~j                                 amd64        Mesa Vulkan graphics drivers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Fair warning, be careful as these drivers are bleeding edge and, by design, may not be stable. After installing the Mesa drivers, you should be able to run glx and Vulkan benchmarks.</p>
<ol start="2" type="1">
<li>Check if opengl detects the dgpu using glxinfo</li>
</ol>
<p>Install glxinfo from apt repo mesa-utils</p>
<p>To use the dGPU, set the env variable <code>DRI_PRIME=1</code>, <a href="https://wiki.archlinux.org/title/PRIME">PRIME</a> is a technology in Linux that uses open source graphics drivers to use <code>switchable graphics</code> and install glxinfo from apt repo mesa-utils.</p>
<p>Here is the output of glxinfo without setting <code>DRI_PRIME</code> environment variable:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → glxinfo <span class="at">-B</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> device</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device:</span> Mesa Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> <span class="er">(</span><span class="ex">ADL</span> GT2<span class="kw">)</span> <span class="kw">(</span><span class="ex">0x46a6</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After setting the environment variable for PRIME:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → export DRI_PRIME=1</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → glxinfo <span class="at">-B</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> device</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device:</span> Mesa Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Arc</span><span class="er">(</span><span class="ex">tm</span><span class="kw">)</span> <span class="ex">A370M</span> Graphics <span class="er">(</span><span class="ex">DG2</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">0x5693</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can the dgpu is recognized by Mesa OpenGL. yay!</p>
<ol start="3" type="1">
<li>Let’s try to run a benchmark on the Arc gpu to see how it performs. I am using glmark2, which can be installed on Ubuntu-based OSes easily using:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → apt-get install glmark2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → export DRI_PRIME=1</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → glxinfo <span class="at">-B</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> device</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device:</span> Mesa Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Arc</span><span class="er">(</span><span class="ex">tm</span><span class="kw">)</span> <span class="ex">A370M</span> Graphics <span class="er">(</span><span class="ex">DG2</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">0x5693</span><span class="kw">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → glmark2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/arc370m_bench.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">glmark2 running on Arc 370m dGPU</figcaption><p></p>
</figure>
</div>
<ol start="4" type="1">
<li>Now, let’s install the intel compute drivers. <a href="https://github.com/intel/compute-runtime/releases">Goto</a>. Get the latest release and install using the deb packages for OpenCL, level zero, igc etc.</li>
</ol>
<p>As of this writing, the latest compute driver release version is <a href="https://github.com/intel/compute-runtime/releases/tag/22.39.24347">22.39.24347</a>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → cd /tmp <span class="kw">&amp;&amp;</span> <span class="fu">mkdir</span> compute_drivers</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → cd compute_drivers</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → wget https://github.com/intel/intel-graphics-compiler/releases/download/igc-1.0.12149.1/intel-igc-core_1.0.12149.1_amd64.deb</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → wget https://github.com/intel/intel-graphics-compiler/releases/download/igc-1.0.12149.1/intel-igc-opencl_1.0.12149.1_amd64.deb</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → wget https://github.com/intel/compute-runtime/releases/download/22.39.24347/intel-level-zero-gpu_1.3.24347_amd64.deb</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → wget https://github.com/intel/compute-runtime/releases/download/22.39.24347/intel-opencl-icd_22.39.24347_amd64.deb</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → wget https://github.com/intel/compute-runtime/releases/download/22.39.24347/libigdgmm12_22.2.0_amd64.deb</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → dpkg <span class="at">-i</span> <span class="pp">*</span>.deb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that the compute drivers are installed let’s see if OpenCL can detect the dgpu. Install <code>clinfo</code> from apt and check using:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → clinfo <span class="kw">|</span> <span class="fu">grep</span> <span class="st">"0x5690"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Device</span> Name                                     Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device</span> Name                                   Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device</span> Name                                   Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Device</span> Name                                   Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can see that the dgpu has been detected.</p>
</section>
<section id="install-oneapi-basekit-and-device-discovery-using-sycl" class="level2">
<h2 class="anchored" data-anchor-id="install-oneapi-basekit-and-device-discovery-using-sycl">Install oneAPI basekit and device discovery using sycl</h2>
<ol type="1">
<li>Finally, install the oneapi basekit to use the dpcpp runtime. I used 2022.2.0 version of oneapi basekit.</li>
</ol>
<p>Please refer to <a href="https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/installation/install-using-package-managers/apt.html#apt">oneAPI installation guide</a> to install using the <code>apt</code> package manager.</p>
<p>Source the oneAPI environment using:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">→</span> source /opt/intel/oneapi/setvars.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~</span> → dpcpp <span class="at">-v</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Intel</span><span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">oneAPI</span> DPC++/C++ Compiler 2022.2.0 <span class="er">(</span><span class="ex">2022.2.0.20220730</span><span class="kw">)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Target:</span> x86_64-unknown-linux-gnu</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Thread</span> model: posix</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">InstalledDir:</span> /opt/intel/oneapi/compiler/2022.2.0/linux/bin-llvm</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/11</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Selected</span> GCC installation: /usr/lib/gcc/x86_64-linux-gnu/11</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Candidate</span> multilib: .<span class="kw">;</span><span class="ex">@m64</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Selected</span> multilib: .<span class="kw">;</span><span class="ex">@m64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Device discovery using sycl-ls see if sycl can detect the dgpu:</li>
</ol>
<p>Intel dgpus like the A370m are represented as SYCL devices. <code>sycl-ls</code> is a tool that is part of the oneAPI basekit that can show all the detected devices and all the SYCL backends support by the runtime. Once the oneapi basekit has been installed, source the environment using:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → source /opt/intel/oneapi/setvars.sh </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Device discovery using syclto see if sycl can detect the dgpu:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → sycl-ls</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[opencl:acc:0]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">FPGA</span> Emulation Platform for OpenCL<span class="er">(</span><span class="ex">TM</span><span class="kw">)</span><span class="ex">,</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">FPGA</span> Emulation Device 1.2 [2022.14.7.0.30_160000]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[opencl:cpu:1]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL,</span> 12th Gen Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Core</span><span class="er">(</span><span class="ex">TM</span><span class="kw">)</span> <span class="ex">i7-12700H</span> 3.0 [2022.14.7.0.30_160000]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[opencl:gpu:2]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL</span> HD Graphics, Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693] 3.0 [22.40.024349]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[opencl:gpu:3]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL</span> HD Graphics, Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x46a6] 3.0 [22.40.024349]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[ext_oneapi_level_zero:gpu:0]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Level-Zero,</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693] 1.3 [1.3.24349]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[ext_oneapi_level_zero:gpu:1]</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Level-Zero,</span> Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x46a6] 1.3 [1.3.24349]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To get a more verbose output, use, <code>sycl-ls --verbose</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → sycl-ls <span class="at">--verbose</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-i</span> name</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">FPGA</span> Emulation Platform for OpenCL<span class="er">(</span><span class="ex">TM</span><span class="kw">)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">FPGA</span> Emulation Device</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : 12th Gen Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Core</span><span class="er">(</span><span class="ex">TM</span><span class="kw">)</span> <span class="ex">i7-12700H</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL</span> HD Graphics</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">OpenCL</span> HD Graphics</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x46a6]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Level-Zero</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x5693]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : Intel<span class="er">(</span><span class="ex">R</span><span class="kw">)</span> <span class="ex">Graphics</span> [0x46a6]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Name</span>     : SYCL host platform</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">Name</span>       : SYCL host device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As seen above 2 GPU devices are detected by the SYCL runtime and are supported using both OpenCL and Level-Zero drivers.</p>
<p>We now have configured the machine with all the required software stack to fully utilize the discrete gpu available on the laptop. These instructions can be used to enable any Arc discrete GPUs like the A370m, A770m, A770, A750 etc on Linux.</p>
</section>
<section id="intels-system-monitoring-utility-to-monitor-the-dgpu" class="level2">
<h2 class="anchored" data-anchor-id="intels-system-monitoring-utility-to-monitor-the-dgpu">Intel’s System Monitoring Utility to monitor the dgpu</h2>
<ol type="1">
<li>Install sysmon</li>
</ol>
<p><code>sysmon</code> is a tool similar to <code>top</code> for cpu, that is part of Intel’s <a href="https://github.com/intel/pti-gpu/tree/master/tools/sysmon">Platform Tools Interfaces for GPU</a>. <code>sysmon</code> helps in monitoring the Intel gpu parameters like frequency, memory, etc. The tool can be installed using:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → git clone https://github.com/intel/pti-gpu/</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → cd pti-gpu/tools/sysmon</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → mkdir build <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> build</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Coding</span> → cmake <span class="at">-DCMAKE_BUILD_TYPE</span><span class="op">=</span>Release .. <span class="kw">&amp;&amp;</span> <span class="fu">make</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>After successfully building <code>sysmon</code> let’s check the dgpu frequency:</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./sysmon</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://user-images.githubusercontent.com/45503355/195416715-923dc33a-acbd-411e-a774-7a38c13e72f3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">system monitor output on my laptop</figcaption><p></p>
</figure>
</div>
<p>As seen above both the igpu and dgpu performance can be monitored using the tool.</p>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>I wouldn’t have been able to do this without the help of <a href="https://github.com/sanchitintel"><span class="citation" data-cites="sanchitintel">@sanchitintel</span></a> and <a href="https://github.com/gujinghui"><span class="citation" data-cites="gujingui">@gujingui</span></a>. Also, <a href="https://www.phoronix.com/review/intel-arc-graphics-linux">Phoronix</a> has been publishing updates on the best way to enable Intel Arc dGPU, detailing the version of the kernel, mesa drivers, etc. That was my start in setting up the software stack.</p>
</section>
<section id="something-not-working" class="level2">
<h2 class="anchored" data-anchor-id="something-not-working">Something not working?</h2>
<p>Please create an <a href="https://github.com/rahulunair/intel_arc_dgpu_linux/issues">issue</a> here to track any issues with these steps.</p>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<p>If you are using this information, please cite using the below link:</p>
<p>Unnikrishnan Nair, R. (2022). dgpu_setup_pytorch (Version 1.0.0) [Computer software]. https://github.com/rahulunair/intel_arc_dgpu_linux</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="rahulunair/myblog" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>